<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Decker's Stock Monitor</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #1c1c1c, #0f2027, #203a43);
      margin: 0; padding: 0; color: #fff;
    }
    header {
      text-align: center; padding: 25px 15px;
      background: rgba(0,0,0,0.6);
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }
    header h1 { margin: 0; font-size: 2.3rem; color: #ffeb3b; }
    header p { margin: 5px 0 0; font-size: 1rem; color: #bbb; }
    .container {
      max-width: 1300px; margin: 30px auto; padding: 20px;
      background: rgba(255,255,255,0.05);
      border-radius: 15px; box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
    .input-section { text-align: center; margin-bottom: 20px; }
    input {
      padding: 12px; font-size: 1rem;
      border-radius: 6px; border: none; outline: none;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
    th, td { padding: 12px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.2); }
    th { background: rgba(0,0,0,0.6); }
    tr:hover { background: rgba(255,255,255,0.1); transition: 0.2s; }
    .profit-pos { color: #4CAF50; font-weight: bold; }
    .profit-neg { color: #FF5252; font-weight: bold; }
    .highlight { background: rgba(255,215,0,0.2); font-weight: bold; }
    td.news { text-align: left; max-width: 250px; font-size: 0.85rem; }
    canvas { width: 120px !important; height: 40px !important; }
  </style>
</head>
<body>
  <header>
    <h1>üìä Decker's Stock Monitor</h1>
    <p>Top 10 fast-profit stocks (‚â§3 months, with 1-week growth, news & charts)</p>
  </header>

  <div class="container">
    <div class="input-section">
      <label for="budget">üí∞ Investment Budget ($): </label>
      <input type="number" id="budget" placeholder="5000" oninput="loadStocks()">
    </div>

    <div id="stocks">Loading...</div>
    <div class="refresh-timer">‚è≥ Next refresh in <span id="countdown"></span> seconds...</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const symbols = ["AAPL","MSFT","NVDA","AMZN","TSLA","GOOG","META","NFLX","AMD","INTC",
                     "ORCL","PYPL","CRM","CSCO","QCOM","IBM","BA","DIS","NKE","KO",
                     "PEP","COST","XOM","CVX","WMT","PFE","V","MA","JPM","GS","UBER"];

    // Mapping for company names
    const companyNames = {
      AAPL: "Apple Inc.",
      MSFT: "Microsoft Corp.",
      NVDA: "NVIDIA Corp.",
      AMZN: "Amazon.com Inc.",
      TSLA: "Tesla Inc.",
      GOOG: "Alphabet Inc. (Google)",
      META: "Meta Platforms Inc.",
      NFLX: "Netflix Inc.",
      AMD: "Advanced Micro Devices",
      INTC: "Intel Corp.",
      ORCL: "Oracle Corp.",
      PYPL: "PayPal Holdings",
      CRM: "Salesforce Inc.",
      CSCO: "Cisco Systems",
      QCOM: "Qualcomm Inc.",
      IBM: "IBM Corp.",
      BA: "Boeing Co.",
      DIS: "Walt Disney Co.",
      NKE: "Nike Inc.",
      KO: "Coca-Cola Co.",
      PEP: "PepsiCo Inc.",
      COST: "Costco Wholesale",
      XOM: "Exxon Mobil Corp.",
      CVX: "Chevron Corp.",
      WMT: "Walmart Inc.",
      PFE: "Pfizer Inc.",
      V: "Visa Inc.",
      MA: "Mastercard Inc.",
      JPM: "JPMorgan Chase",
      GS: "Goldman Sachs",
      UBER: "Uber Technologies"
    };

    let stockData = [];
    const refreshInterval = 60;
    let countdown = refreshInterval;

    function avg(arr) {
      return arr.reduce((a,b)=>a+b,0)/arr.length;
    }

    async function fetchNewsSnippet(symbol) {
      try {
        const url = `https://query1.finance.yahoo.com/v1/finance/search?q=${symbol}`;
        const proxy = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
        const res = await fetch(proxy);
        const wrapped = await res.json();
        const obj = JSON.parse(wrapped.contents);
        if (obj.news && obj.news.length > 0) {
          return obj.news[0].title;
        }
      } catch (_) {}
      return "No latest news affecting the stock behavior";
    }

    async function getYahooData(symbol, range="3mo") {
      try {
        const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=${range}`;
        const proxy = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
        const res = await fetch(proxy);
        const wrapped = await res.json();
        const data = JSON.parse(wrapped.contents);
        const prices = data.chart.result[0].indicators.quote[0].close;
        const timestamps = data.chart.result[0].timestamp;
        if (!prices || prices.length < 22) return null;

        const latest = prices[prices.length-1];
        const budget = parseFloat(document.getElementById("budget").value) || 1000;

        const horizons = { "1W":5, "2W":10, "3W":15, "1M":22, "3M":66 };
        let best = { label: "-", val: -Infinity, date: "", pct: 0 };
        let oneWeekLabel = "-";

        for (const [label, days] of Object.entries(horizons)) {
          if (prices.length > days) {
            const window = prices.slice(prices.length - days - 3, prices.length - days + 2).filter(v=>v != null);
            if (window.length > 0) {
              const past = avg(window);
              if (past > 0) {
                const ret = (latest - past) / past;
                const profit = ret * budget;
                if (label === "1W") {
                  oneWeekLabel = `${label}: $${profit.toFixed(2)} (${(ret*100).toFixed(1)}%)`;
                }
                if (profit > best.val && ret < 0.5) {
                  const sellTs = timestamps[timestamps.length - days];
                  const sellDate = new Date(sellTs * 1000).toLocaleDateString();
                  best = { label, val: profit, date: sellDate, pct: ret * 100 };
                }
              }
            }
          }
        }

        const news = await fetchNewsSnippet(symbol);

        return {
          symbol,
          name: companyNames[symbol] || symbol,
          price: latest.toFixed(2),
          oneWeek: oneWeekLabel,
          best,
          news,
          prices
        };
      } catch (_) {
        return null;
      }
    }

    async function loadStocks() {
      document.getElementById("stocks").innerHTML = "Refreshing data...";
      const promises = symbols.map(s => getYahooData(s));
      const results = await Promise.all(promises);
      stockData = results.filter(r => r !== null);

      stockData.sort((a, b) => b.best.val - a.best.val);
      stockData = stockData.slice(0, 10);
      updateTable();
    }

    function updateTable() {
      let html = `<table>
        <tr>
          <th>Rank</th><th>Symbol</th><th>Company</th><th>Price</th>
          <th>1-Week Growth</th><th>Profit ($)</th><th>Best Sell (‚â§3M)</th><th>Trend Summary</th><th>Chart</th>
        </tr>`;
      stockData.forEach((s, idx) => {
        const profit = s.best.val > 0 ? `$${s.best.val.toFixed(2)}` : "-";
        const sellLabel = s.best.label !== "-" ? `${s.best.label} ‚Üí ${s.best.date}` : "-";
        const canvasId = `chart-${idx}`;
        html += `<tr>
          <td>#${idx+1}</td>
          <td>${s.symbol}</td>
          <td>${s.name}</td>
          <td>$${s.price}</td>
          <td>${s.oneWeek}</td>
          <td class="${s.best.val>=0 ? 'profit-pos':'profit-neg'}">${profit}</td>
          <td class="highlight">${sellLabel}</td>
          <td class="news">${s.news}</td>
          <td><canvas id="${canvasId}"></canvas></td>
        </tr>`;
      });
      html += `</table>`;
      document.getElementById("stocks").innerHTML = html;

      // draw charts
      stockData.forEach((s, idx) => {
        const ctx = document.getElementById(`chart-${idx}`);
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: s.prices.map((_, i) => i),
            datasets: [{
              data: s.prices,
              borderColor: "#4CAF50",
              backgroundColor: "transparent",
              tension: 0.3,
              borderWidth: 2,
              pointRadius: 0
            }]
          },
          options: {
            responsive: false,
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: false } }
          }
        });
      });
    }

    function startAutoRefresh() {
      setInterval(() => {
        countdown--;
        if (countdown <= 0) {
          loadStocks();
          countdown = refreshInterval;
        }
        document.getElementById("countdown").innerText = countdown;
      }, 1000);
    }

    loadStocks();
    startAutoRefresh();
  </script>
</body>
</html>
