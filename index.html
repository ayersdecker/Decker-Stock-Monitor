<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Decker's Stock Monitor</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2331/2331941.png" type="image/png">
  <style>
    :root {
      --bg:#0a0f0f; --panel:#0d1117; --green:#00ff99; --red:#ff4d4d; --cyan:#33ccff; --text:#e0e0e0;
    }
    body {
      font-family:'Fira Code',Consolas,monospace;
      background:linear-gradient(145deg,var(--bg),#000);
      color:var(--text); margin:0;
    }
    header {
      padding:24px 16px;
      background:var(--panel);
      border-bottom:2px solid var(--green);
      box-shadow:0 0 15px rgba(0,255,153,.2);
      text-align:center;
    }
    header h1 {
      margin:0; font-size:2.2rem;
      color:var(--green); text-shadow:0 0 5px var(--green);
    }
    header p { margin:6px 0 0; color:#aaa; }

    .container {
      max-width:1500px;
      margin:26px auto;
      padding:18px;
      background:var(--panel);
      border-radius:10px;
      box-shadow:0 0 20px rgba(0,255,153,.15);
    }

    .controls { display:grid;grid-template-columns:repeat(12,1fr);gap:10px;align-items:end }
    .ctrl{display:flex;flex-direction:column;gap:6px}
    label{font-size:.8rem;color:#aaa}
    input,button{border:1px solid var(--cyan);background:#0a0f0f;color:var(--text);padding:10px;border-radius:6px;outline:none}
    button{cursor:pointer;font-weight:700}
    button:hover{box-shadow:0 0 10px rgba(51,204,255,.25)}
    .wide{grid-column:span 3}
    .medium{grid-column:span 2}
    .bar{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .timer{color:#aaa;font-size:.85rem}

    .table-wrap{overflow:auto;margin-top:14px;border:1px solid #1a1f24;border-radius:8px}
    table{width:100%;border-collapse:collapse;font-size:.9rem;min-width:1200px}
    th,td{padding:10px 8px;border-bottom:1px solid rgba(255,255,255,.06);text-align:center}
    th{position:sticky;top:0;background:#111;color:var(--cyan);text-transform:uppercase;font-size:.75rem;cursor:pointer}
    tr:hover{background:rgba(0,255,153,.08)}

    .profit-pos{color:var(--green);font-weight:700;text-shadow:0 0 5px var(--green)}
    .profit-neg{color:var(--red);font-weight:700;text-shadow:0 0 5px var(--red)}
    .pos{color:var(--green);font-weight:700}
    .neg{color:var(--red);font-weight:700}
    .highlight{background:rgba(51,204,255,.15);font-weight:700}
    .news{text-align:left;max-width:280px}
    a{color:var(--cyan);text-decoration:none}
    a:hover{text-decoration:underline}
    canvas{width:130px !important;height:42px !important}

    .pill{border:1px dashed var(--cyan);padding:8px;border-radius:6px;margin-top:8px}
    .remove-btn{border-color:#444;color:#ccc}
    .remove-btn:hover{border-color:#ff7777;color:#fff}

    .hidden{display:none}
    #toggleHoldingsBtn,#toggleControlsBtn {
      background:#0d1117; color:#33ccff; border:1px solid #33ccff;
      padding:8px 14px; border-radius:6px; font-weight:600; cursor:pointer;
      margin-top:12px;
    }
    #toggleHoldingsBtn:hover,#toggleControlsBtn:hover {
      background:#111; box-shadow:0 0 10px rgba(51,204,255,.25);
    }
  </style>
</head>
<body>
  <header>
    <h1>üìä Decker's Stock Monitor</h1>
    <p>Fast-profit stocks (‚â§3 months) ‚Ä¢ console/Robinhood style</p>
  </header>

  <div class="container">

    <!-- Controls toggle -->
    <button id="toggleControlsBtn">‚öôÔ∏è Show Controls</button>
    <div id="controlsPanel" class="hidden">
      <div class="controls">
        <div class="ctrl medium">
          <label>üí∞ Investment Budget ($)</label>
          <input id="budget" type="number" placeholder="0">
        </div>

        <div class="ctrl medium">
          <label>üîé Filter (Symbol / Company)</label>
          <input id="filter" type="text" placeholder="e.g., AAPL or Apple">
        </div>

        <div class="ctrl wide">
          <label>‚ûï Add Symbol</label>
          <div style="display:flex;gap:8px">
            <input id="addSymbol" placeholder="Ticker, e.g., AAPL">
            <button id="addBtn">Add</button>
          </div>
        </div>

        <div class="ctrl wide">
          <label>‚è±Ô∏è Refresh</label>
          <div class="bar">
            <div class="left">
              <button id="refreshBtn">Refresh Now</button>
            </div>
            <div class="right">
              <span class="timer">Next auto refresh in <span id="countdown">60</span>s</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Holdings editor toggle -->
    <button id="toggleHoldingsBtn">üì¶ Show Holdings Editor</button>
    <div id="holdingsEditor" class="hidden pill">
      <strong>üì¶ Holdings Editor:</strong> set your <em>Shares</em> and <em>Buy Price</em> per symbol to get real PROFIT ($).
      <div id="holdingsRow" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px"></div>
    </div>

    <!-- Table -->
    <div class="table-wrap">
      <table id="stocksTable">
        <thead>
          <tr>
            <th data-col="rank">Rank</th>
            <th data-col="symbol">Symbol</th>
            <th data-col="name">Company</th>
            <th data-col="price">Price</th>
            <th data-col="g1">1D</th>
            <th data-col="g5">1W</th>
            <th data-col="g22">1M</th>
            <th data-col="g66">3M</th>
            <th data-col="profit">PROFIT ($)</th>
            <th data-col="bestSell">Best Sell</th>
            <th data-col="volume">Volume</th>
            <th data-col="mcap">Mkt Cap</th>
            <th data-col="news">Trend Summary</th>
            <th>Chart</th>
            <th>Remove</th>
          </tr>
        </thead>
        <tbody id="stocksBody"><tr><td colspan="15">Loading‚Ä¶</td></tr></tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // --- simplified helpers from previous code ---
    const proxy = "https://api.allorigins.win/get?url=";
    let symbols = JSON.parse(localStorage.getItem("dsm_symbols")) || ["AAPL","MSFT","NVDA","AMZN","TSLA"];
    let holdings = JSON.parse(localStorage.getItem("dsm_holdings")) || {};
    let countdown = 60, rowsCache = [];

    const $=(s)=>document.querySelector(s);
    const avg=(a)=>a.reduce((x,y)=>x+y,0)/a.length;
    const fmtMoney=(n)=>"$"+(isFinite(n)?n.toFixed(2):"0.00");
    const fmtPct=(p)=>isFinite(p)?(p>0?"+":"")+p.toFixed(1)+"%":"0.0%";
    const growthClass=(p)=>p>=0?"pos":"neg";

    function saveState(){localStorage.setItem("dsm_symbols",JSON.stringify(symbols));localStorage.setItem("dsm_holdings",JSON.stringify(holdings));}

    async function fetchChartData(sym){
      try{
        const url=`https://query1.finance.yahoo.com/v8/finance/chart/${sym}?interval=1d&range=3mo`;
        const res=await fetch(proxy+encodeURIComponent(url));
        const w=await res.json();const d=JSON.parse(w.contents);
        const r=d?.chart?.result?.[0];if(!r)return null;
        return{prices:r.indicators.quote[0].close,ts:r.timestamp};
      }catch(e){return null;}
    }
    async function fetchQuotes(list){
      const url=`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${list.join(",")}`;
      const res=await fetch(proxy+encodeURIComponent(url));
      const w=await res.json();const d=JSON.parse(w.contents);
      const map={};(d?.quoteResponse?.result||[]).forEach(q=>{
        map[q.symbol]={price:q.regularMarketPrice,volume:q.regularMarketVolume,marketCap:q.marketCap};
      });return map;
    }

    function computeRet(latest,prices,days){if(!prices||prices.length<=days)return null;
      const past=avg(prices.slice(prices.length-days-2,prices.length-days+2).filter(v=>v!=null));
      return past?((latest-past)/past):null;}

    function profitFromHoldings(sym,price){const h=holdings[sym];return h&&h.shares&&h.buy?h.shares*(price-h.buy):0;}

    function renderHoldingsEditor(){
      const wrap=$("#holdingsRow");wrap.innerHTML="";
      symbols.forEach(sym=>{
        const h=holdings[sym]||{};
        wrap.innerHTML+=`
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:6px;min-width:220px">
            <div class="ctrl"><label>${sym} Shares</label><input type="number" data-type="shares" data-sym="${sym}" value="${h.shares??""}"></div>
            <div class="ctrl"><label>${sym} Buy Price</label><input type="number" data-type="buy" data-sym="${sym}" value="${h.buy??""}"></div>
          </div>`;
      });
      wrap.querySelectorAll("input").forEach(inp=>{
        inp.oninput=(e)=>{
          const sym=e.target.dataset.sym,t=e.target.dataset.type;
          holdings[sym]=holdings[sym]||{};
          const v=parseFloat(e.target.value);
          holdings[sym][t]=isNaN(v)?null:v;
          saveState();updateTable();
        };
      });
    }

    async function loadAll(){
      $("#stocksBody").innerHTML="<tr><td colspan=15>Refreshing‚Ä¶</td></tr>";
      const quotes=await fetchQuotes(symbols);
      const results=[];
      for(const sym of symbols){
        const q=quotes[sym]||{};
        const chart=await fetchChartData(sym);
        if(!chart)continue;
        const latest=q.price??chart.prices.at(-1);
        results.push({
          symbol:sym,price:latest,
          g1:computeRet(latest,chart.prices,1),
          g5:computeRet(latest,chart.prices,5),
          g22:computeRet(latest,chart.prices,22),
          g66:computeRet(latest,chart.prices,66),
          volume:q.volume,mcap:q.marketCap,prices:chart.prices
        });
      }
      rowsCache=results;updateTable();renderHoldingsEditor();
    }

    function updateTable(){
      const body=$("#stocksBody");body.innerHTML="";
      rowsCache.forEach((r,idx)=>{
        const profit=profitFromHoldings(r.symbol,r.price);
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>#${idx+1}</td>
          <td>${r.symbol}</td>
          <td>${r.symbol}</td>
          <td>${fmtMoney(r.price)}</td>
          <td class="${growthClass(r.g1*100)}">${fmtPct(r.g1*100)}</td>
          <td class="${growthClass(r.g5*100)}">${fmtPct(r.g5*100)}</td>
          <td class="${growthClass(r.g22*100)}">${fmtPct(r.g22*100)}</td>
          <td class="${growthClass(r.g66*100)}">${fmtPct(r.g66*100)}</td>
          <td class="${profit>=0?"profit-pos":"profit-neg"}">${fmtMoney(profit)}</td>
          <td>-</td>
          <td>${r.volume??"-"}</td>
          <td>${r.mcap??"-"}</td>
          <td class="news">-</td>
          <td><canvas id="c-${r.symbol}"></canvas></td>
          <td><button class="remove-btn" data-rm="${r.symbol}">‚úñ</button></td>`;
        body.appendChild(tr);
        new Chart(tr.querySelector(`#c-${r.symbol}`),{type:'line',data:{labels:r.prices.map((_,i)=>i),datasets:[{data:r.prices,borderColor:"#00ff99",tension:.3,pointRadius:0}]},options:{responsive:false,plugins:{legend:{display:false}},scales:{x:{display:false},y:{display:false}}}});
        tr.querySelector("[data-rm]").onclick=()=>{symbols=symbols.filter(s=>s!==r.symbol);delete holdings[r.symbol];saveState();renderHoldingsEditor();loadAll();};
      });
    }

    // --- Toggles ---
    const holdBtn=$("#toggleHoldingsBtn"),holdBox=$("#holdingsEditor");
    let holdVis=JSON.parse(localStorage.getItem("dsm_holdingsVisible"))??false;
    holdBox.classList.toggle("hidden",!holdVis);
    holdBtn.textContent=holdVis?"üì¶ Hide Holdings Editor":"üì¶ Show Holdings Editor";
    holdBtn.onclick=()=>{holdVis=!holdVis;localStorage.setItem("dsm_holdingsVisible",JSON.stringify(holdVis));holdBox.classList.toggle("hidden",!holdVis);holdBtn.textContent=holdVis?"üì¶ Hide Holdings Editor":"üì¶ Show Holdings Editor";};

    const ctrlBtn=$("#toggleControlsBtn"),ctrlBox=$("#controlsPanel");
    let ctrlVis=JSON.parse(localStorage.getItem("dsm_controlsVisible"))??false;
    ctrlBox.classList.toggle("hidden",!ctrlVis);
    ctrlBtn.textContent=ctrlVis?"‚öôÔ∏è Hide Controls":"‚öôÔ∏è Show Controls";
    ctrlBtn.onclick=()=>{ctrlVis=!ctrlVis;localStorage.setItem("dsm_controlsVisible",JSON.stringify(ctrlVis));ctrlBox.classList.toggle("hidden",!ctrlVis);ctrlBtn.textContent=ctrlVis?"‚öôÔ∏è Hide Controls":"‚öôÔ∏è Show Controls";};

    // --- Events ---
    $("#addBtn").onclick=()=>{const s=$("#addSymbol").value.trim().toUpperCase();if(s&&!symbols.includes(s)){symbols.push(s);saveState();loadAll();}$("#addSymbol").value="";};
    $("#refreshBtn").onclick=()=>{countdown=60;loadAll();};
    $("#filter").oninput=()=>{updateTable();};

    // --- Countdown ---
    setInterval(()=>{countdown--;if(countdown<=0){countdown=60;loadAll();}$("#countdown").textContent=countdown;},1000);

    loadAll();
  </script>
</body>
</html>
