<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Decker's Stock Monitor</title>

  <!-- Finance themed favicon -->
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2331/2331941.png" type="image/png">

  <style>
    body {
      font-family: 'Fira Code', Consolas, monospace;
      background: linear-gradient(145deg, #0a0f0f, #000000);
      margin: 0; padding: 0; color: #e0e0e0;
    }
    header {
      text-align: center; padding: 25px 15px;
      background: #0d1117;
      border-bottom: 2px solid #00ff99;
      box-shadow: 0 0 15px rgba(0, 255, 153, 0.2);
    }
    header h1 { margin: 0; font-size: 2.5rem; color: #00ff99; text-shadow: 0 0 5px #00ff99; }
    header p { margin: 5px 0 0; font-size: 1rem; color: #aaa; }

    .container {
      max-width: 1350px; margin: 30px auto; padding: 20px;
      background: #0d1117;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,255,153,0.15);
    }

    .input-section { text-align: center; margin-bottom: 20px; }
    input {
      padding: 10px; font-size: 1rem;
      border-radius: 5px; border: 1px solid #33ccff; outline: none;
      background: #0a0f0f; color: #e0e0e0;
      box-shadow: inset 0 0 10px rgba(51,204,255,0.2);
    }

    table { 
      width: 100%; border-collapse: collapse; 
      margin-top: 20px; font-size: 0.9rem;
    }
    th, td { 
      padding: 12px; text-align: center; 
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    th { 
      background: #111; 
      color: #33ccff; 
      text-transform: uppercase;
      font-size: 0.8rem;
      letter-spacing: 1px;
    }
    tr { transition: background 0.2s; }
    tr:hover { background: rgba(0,255,153,0.08); }

    .profit-pos { color: #00ff99; font-weight: bold; text-shadow: 0 0 5px #00ff99; }
    .profit-neg { color: #ff4d4d; font-weight: bold; text-shadow: 0 0 5px #ff4d4d; }
    .highlight { background: rgba(51,204,255,0.15); font-weight: bold; }
    td.news { text-align: left; max-width: 280px; font-size: 0.85rem; color: #ddd; }
    canvas { width: 120px !important; height: 40px !important; }

    a { color: #33ccff; text-decoration: none; }
    a:hover { text-decoration: underline; }

    .refresh-timer {
      margin-top: 10px;
      text-align: center;
      font-size: 0.8rem;
      color: #aaa;
    }
  </style>
</head>
<body>
  <header>
    <h1>üìä Decker's Stock Monitor</h1>
    <p>Top 10 fast-profit stocks (‚â§3 months, tech-console style)</p>
  </header>

  <div class="container">
    <div class="input-section">
      <label for="budget">üí∞ Investment Budget ($): </label>
      <input type="number" id="budget" placeholder="0" oninput="loadStocks()">
    </div>

    <div id="stocks">Loading...</div>
    <div class="refresh-timer">‚è≥ Next refresh in <span id="countdown"></span> seconds...</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const proxy = "https://api.allorigins.win/get?url=";

    const symbols = ["AAPL","MSFT","NVDA","AMZN","TSLA","GOOG","META","NFLX","AMD","INTC",
                     "ORCL","PYPL","CRM","CSCO","QCOM","IBM","BA","DIS","NKE","KO",
                     "PEP","COST","XOM","CVX","WMT","PFE","V","MA","JPM","GS","UBER"];

    const companyNames = {
      AAPL: "Apple Inc.", MSFT: "Microsoft Corp.", NVDA: "NVIDIA Corp.", AMZN: "Amazon.com Inc.",
      TSLA: "Tesla Inc.", GOOG: "Alphabet Inc. (Google)", META: "Meta Platforms Inc.", NFLX: "Netflix Inc.",
      AMD: "Advanced Micro Devices", INTC: "Intel Corp.", ORCL: "Oracle Corp.", PYPL: "PayPal Holdings",
      CRM: "Salesforce Inc.", CSCO: "Cisco Systems", QCOM: "Qualcomm Inc.", IBM: "IBM Corp.",
      BA: "Boeing Co.", DIS: "Walt Disney Co.", NKE: "Nike Inc.", KO: "Coca-Cola Co.", PEP: "PepsiCo Inc.",
      COST: "Costco Wholesale", XOM: "Exxon Mobil Corp.", CVX: "Chevron Corp.", WMT: "Walmart Inc.",
      PFE: "Pfizer Inc.", V: "Visa Inc.", MA: "Mastercard Inc.", JPM: "JPMorgan Chase",
      GS: "Goldman Sachs", UBER: "Uber Technologies"
    };

    const blacklist = [
      "AI Stocks In Buy Areas",
      "Sector Update",
      "Tech Stocks Gain",
      "Market Summary",
      "ETF",
    ];

    let stockData = [];
    const refreshInterval = 60;
    let countdown = refreshInterval;

    function avg(arr) { return arr.reduce((a,b)=>a+b,0)/arr.length; }

    async function fetchNewsSnippet(symbol) {
      try {
        const url = `https://query1.finance.yahoo.com/v1/finance/search?q=${symbol}`;
        const res = await fetch(proxy + encodeURIComponent(url));
        const wrapped = await res.json();
        const obj = JSON.parse(wrapped.contents);

        if (obj.news && obj.news.length > 0) {
          const valid = obj.news.find(n =>
            n.link &&
            n.publisher &&
            blacklist.every(bad => !n.title.includes(bad))
          );
          if (valid) {
            return { title: valid.title, link: valid.link };
          }
        }
      } catch (err) {
        console.error("News fetch failed for", symbol, err);
      }
      return { title: "No latest news affecting the stock behavior", link: null };
    }

    async function getYahooData(symbol, range="3mo") {
      try {
        const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=${range}`;
        const res = await fetch(proxy + encodeURIComponent(url));
        const wrapped = await res.json();
        const data = JSON.parse(wrapped.contents);
        const prices = data.chart.result[0].indicators.quote[0].close;
        const timestamps = data.chart.result[0].timestamp;
        if (!prices || prices.length < 22) return null;

        const latest = prices[prices.length-1];
        let budget = parseFloat(document.getElementById("budget").value);
        if (isNaN(budget)) budget = 0;

        const horizons = { "1W":5, "2W":10, "3W":15, "1M":22, "3M":66 };
        let best = { label: "-", val: 0, date: "-", pct: 0 };
        let oneWeekLabel = "1W: $0 (0%)";

        for (const [label, days] of Object.entries(horizons)) {
          if (prices.length > days) {
            const window = prices.slice(prices.length - days - 3, prices.length - days + 2).filter(v=>v != null);
            if (window.length > 0) {
              const past = avg(window);
              if (past > 0) {
                const ret = (latest - past) / past;
                const profit = ret * budget;
                if (label === "1W") {
                  oneWeekLabel = `1W: $${profit.toFixed(2)} (${(ret*100).toFixed(1)}%)`;
                }
                if (profit > best.val && ret < 0.5) {
                  const sellTs = timestamps[timestamps.length - days];
                  const sellDate = new Date(sellTs * 1000).toLocaleDateString();
                  best = { label, val: profit, date: sellDate, pct: ret * 100 };
                }
              }
            }
          }
        }

        const news = await fetchNewsSnippet(symbol);

        return {
          symbol,
          name: companyNames[symbol] || symbol,
          price: latest.toFixed(2),
          oneWeek: oneWeekLabel,
          best,
          news,
          prices
        };
      } catch (err) {
        console.error("Stock fetch failed for", symbol, err);
        return null;
      }
    }

    async function loadStocks() {
      document.getElementById("stocks").innerHTML = "Refreshing data...";
      const promises = symbols.map(s => getYahooData(s));
      const results = await Promise.all(promises);
      stockData = results.filter(r => r !== null);

      stockData.sort((a, b) => b.best.val - a.best.val);
      stockData = stockData.slice(0, 10);
      updateTable();
    }

    function updateTable() {
      let html = `<table>
        <tr>
          <th>Rank</th><th>Symbol</th><th>Company</th><th>Price</th>
          <th>1-Week Growth</th><th>Profit ($)</th><th>Best Sell (‚â§3M)</th><th>Trend Summary</th><th>Chart</th>
        </tr>`;
      stockData.forEach((s, idx) => {
        const profit = `$${s.best.val.toFixed(2)}`;
        const sellLabel = s.best.label !== "-" ? `${s.best.label} ‚Üí ${s.best.date}` : "-";
        const canvasId = `chart-${idx}`;
        const newsHTML = s.news.link
          ? `<a href="${s.news.link}" target="_blank">${s.news.title}</a>`
          : s.news.title;

        html += `<tr>
          <td>#${idx+1}</td>
          <td>${s.symbol}</td>
          <td>${s.name}</td>
          <td>$${s.price}</td>
          <td>${s.oneWeek}</td>
          <td class="${s.best.val>=0 ? 'profit-pos':'profit-neg'}">${profit}</td>
          <td class="highlight">${sellLabel}</td>
          <td class="news">${newsHTML}</td>
          <td><canvas id="${canvasId}"></canvas></td>
        </tr>`;
      });
      html += `</table>`;
      document.getElementById("stocks").innerHTML = html;

      // Draw charts
      stockData.forEach((s, idx) => {
        const ctx = document.getElementById(`chart-${idx}`);
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: s.prices.map((_, i) => i),
            datasets: [{
              data: s.prices,
              borderColor: "#00ff99",
              backgroundColor: "transparent",
              tension: 0.3,
              borderWidth: 2,
              pointRadius: 0
            }]
          },
          options: {
            responsive: false,
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: false } }
          }
        });
      });
    }

    function startAutoRefresh() {
      setInterval(() => {
        countdown--;
        if (countdown <= 0) {
          loadStocks();
          countdown = refreshInterval;
        }
        document.getElementById("countdown").innerText = countdown;
      }, 1000);
    }

    loadStocks();
    startAutoRefresh();
  </script>
</body>
</html>

